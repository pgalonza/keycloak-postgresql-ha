global
  log stdout format raw local0 info

defaults
    mode                    tcp
    log                     global
    option                  tcplog
    retries                 3
    timeout queue           1m
    timeout connect         10s
    timeout client          1m
    timeout server          1m
    timeout check           10s
    maxconn                 3000

listen stats
    mode http
    bind *:7000
    stats enable
    stats uri /

listen primary
    bind :5000
    option httpchk OPTIONS /master
    http-check expect status 200
    default-server inter 3s fall 3 rise 2 on-marked-down shutdown-sessions
    server node1 pgbouncer1:6432 maxconn 100 check port 8008 addr postgresql-patroni1
    server node2 pgbouncer2:6432 maxconn 100 check port 8008 addr postgresql-patroni2
    server node3 pgbouncer3:6432 maxconn 100 check port 8008 addr postgresql-patroni3

listen standby
    bind :5001
    balance roundrobin
    option httpchk OPTIONS /replica
    http-check expect status 200
    default-server inter 3s fall 3 rise 2 on-marked-down shutdown-sessions
    server node1 pgbouncer1:6432 maxconn 100 check port 8008 addr postgresql-patroni1
    server node2 pgbouncer2:6432 maxconn 100 check port 8008 addr postgresql-patroni2
    server node3 pgbouncer3:6432 maxconn 100 check port 8008 addr postgresql-patroni3
