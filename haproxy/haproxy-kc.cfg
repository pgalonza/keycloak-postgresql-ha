global
  log stdout format raw local0 info

defaults
    log global
    mode http
    option httplog
    option dontlognull
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

listen stats
    mode http
    bind *:7000
    stats enable
    stats uri /

frontend prometheus
    bind *:8405
    mode http
    http-request use-service prometheus-exporter if { path /metrics }
    no log

frontend keycloak_http
    bind *:80
    default_backend keycloak_servers

backend keycloak_servers
    balance roundrobin
    option redispatch
    option log-health-checks
    option httpchk OPTIONS /health
    http-check expect status 200
    server node1 keycloak1:8081 check port 9000
    server node2 keycloak2:8081 check port 9000
